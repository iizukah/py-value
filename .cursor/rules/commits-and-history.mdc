---
description: 変更は必ずコミット。編集時は必ず99_historyに報告する。Conventional Commitsを採用。WindowsではUTF-8でコミットメッセージを保存する。
alwaysApply: true
---

# コミットと99_history

## コミット
- 意味のある変更単位で**必ずコミット**する。
- **Conventional Commits**を採用: `feat:`, `fix:`, `docs:`, `refactor:` 等。本文にドキュメントIDや理由を記載し、Cursorが後から参照しやすいようにする。

### コミットメッセージの文字化け防止（Windows／自動実行時）
- 日本語など非ASCIIを含むメッセージを **`git commit -m "..."` で直接渡すと、PowerShell のコードページ等により文字化けし、フォーマットも崩れる**。そのため **`-m` は使わず、必ずファイル経由でコミットする**。
- **手順（必須）**:
  1. コミットメッセージを **UTF-8（BOM なし推奨）** のテキストファイルに書き、保存する。例: `.cursor/commit_msg_utf8.txt` または `.git_commit_msg.txt`。
  2. `git commit -F .cursor/commit_msg_utf8.txt` のように **`-F <ファイルパス>`** でコミットする。
  3. 一時ファイルを使った場合はコミット後に削除するか、`.gitignore` に追加する。本リポジトリでは `.git_commit_msg.txt` が .gitignore 済みのため、そのファイルに書き `git commit -F .git_commit_msg.txt` してもコミット対象にならない。
- **リポジトリ推奨の Git 設定（一度だけ実行）**: 文字化けとログ表示を防ぐため、リポジトリで以下を設定する。
  - `git config core.quotepath false`
  - `git config i18n.commitEncoding utf-8`
  - `git config i18n.logOutputEncoding utf-8`
- 自動実行（エージェント・スクリプト）では、**日本語メッセージの場合は必ず `-F` を使う**。`-m` は英語のみの短いメッセージに限る。

例（ファイルに書く内容）:
```
feat(UC-02): コード実行をShift+Enterでトリガー
docs(SC-001): API仕様を01_specsに追加
```

## 99_history
- **場所**: `docs/99_history/`
- **編集・修正時は必ず報告する**: 仕様書（01_specs）・設計・運用ドキュメント・プロジェクト設定（.cursor 等）を編集したときは、必ず 99_history に報告する。**実装やバグ修正を行ったときも、99_history に新規書き込みまたは関連事項なら既存ファイルに追記する。** 新規の事象・変更なら新規ファイルを連番で作成し、既存の同一機能・同一障害に関する追記なら該当する 99_history ファイルに追記する。
- **新規ファイル**: `0001_概要.md`, `0002_API変更.md` のように**連番プレフィックス**（リポジトリ全体で1本の連番）で作成し、日付・変更内容・関連ドキュメントIDを記載する。コミット前に「99_history に記録したか」を確認すること。
- **仕様変更**: 仕様書・設計の変更はここに記録。中身に日付・変更内容・関連ドキュメントIDを記載。後からコンテキストが分かる粒度で書く。
