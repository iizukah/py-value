# 0033 お気に入り・履歴・ワークスペース・問題一覧・インポート用問題

## 日付

2025-02-07

## 実施内容概要

- **履歴詳細（DD 関連）**: 「userAnswer」→「あなたの回答」、「JudgedAt」→「受験日時」にラベル変更。
- **履歴一覧**: 詳細列（4列目）削除、「一覧へ戻る」をテーブル直下の左下に配置、タイトルとテーブルの位置揃え（カードの maxWidth/margin を削除）。
- **お気に入りパネル**: 問題一覧と同様にバッジ（合格/不合格/未挑戦）と問題文抜粋（problem_statement または excerpt）を表示。履歴 API で status を算出し、TileBadge を表示。
- **問題一覧**: 表示を「{workbookTitle}：問題一覧」の1行に変更。ステータスフィルター（全て/未挑戦/未合格/合格）、難易度フィルター（全て/初級/中級/上級）を追加。ソート・フィルターを折りたたみ可能にしデフォルト折りたたみ（DD-018～DD-020）。
- **ワークスペース**: ローディングの縦帯（scanning-line-bar）を relative + overflow-hidden のラッパーで囲みアニメーションを修正。コード入力に Python シンタックスハイライト（軽量オーバーレイ・差し替え可能）を適用（DD-022）。採点結果表示時に問題一覧をランダム最大10問表示、Retry で非表示（DD-021）。コード入力の caret/line-height を改善。
- **99_diff**: DD-018～DD-022 を 0009 に追記。
- **インポート用問題**: docs/.drafts に 6 問を 1 ファイルにまとめた `import_questions.json` を配置。

---

## インポート用問題の概要と解説

管理画面のインポートで利用できる `docs/.drafts/import_questions.json` は、配列形式の 6 問を 1 ファイルにまとめたものです。以下、各問題のねらい・使用ライブラリ・期待する解答の例・解説（解答コード例スニペット）を記載します。

---

### 1. Iris 種別ごとの平均（pandas）

- **ねらい**: sklearn の iris を pandas で扱い、種別ごとの集約を行う。
- **使用ライブラリ**: pandas, sklearn.datasets
- **期待する解答の例**: 種別（0, 1, 2）ごとの sepal length (cm) の平均を表した Series または dict を `ans` に代入する。
- **解説**: `load_iris()` でデータを取得し、DataFrame 化したうえで `groupby('target')` で集約し、該当列の `mean()` を取る。

```python
import pandas as pd
from sklearn.datasets import load_iris
iris = load_iris()
df = pd.DataFrame(iris.data, columns=iris.feature_names)
df['target'] = iris.target
ans = df.groupby('target')['sepal length (cm)'].mean()
```

---

### 2. 簡単な折れ線グラフ（matplotlib）

- **ねらい**: matplotlib で簡単な折れ線グラフを描画し、Pyodide 環境で表示する。
- **使用ライブラリ**: matplotlib
- **期待する解答の例**: プロット後に `plt.show()` を呼び、`ans = True` を代入する。
- **解説**: バックエンド設定ののち、`plt.plot()` でデータを描画し、`plt.show()` で Result Plot に表示する。

```python
import matplotlib
matplotlib.use('module://matplotlib_backend_pyodide')
import matplotlib.pyplot as plt
plt.plot([1, 4, 2, 5])
plt.show()
ans = True
```

---

### 3. 配列の合計（numpy）

- **ねらい**: numpy の配列を作成し、合計を求める。
- **使用ライブラリ**: numpy
- **期待する解答の例**: `ans = 55`（1～10 の合計）
- **解説**: `np.arange(1, 11)` で配列を作成し、`np.sum()` で合計する。

```python
import numpy as np
arr = np.arange(1, 11)
ans = np.sum(arr)  # 55
```

---

### 4. 簡単な回帰（pandas + statsmodels）

- **ねらい**: pandas でデータを用意し、statsmodels の OLS で単回帰を行い、決定係数を得る。
- **使用ライブラリ**: pandas, statsmodels.api
- **期待する解答の例**: 回帰結果の `rsquared` を `ans` に代入する。
- **解説**: DataFrame を作成し、`sm.OLS(y, sm.add_constant(x)).fit()` でフィットし、`.rsquared` を取得する。

```python
import pandas as pd
import statsmodels.api as sm
df = pd.DataFrame({'x': [1,2,3,4,5], 'y': [2,4,5,4,5]})
model = sm.OLS(df['y'], sm.add_constant(df['x'])).fit()
ans = model.rsquared
```

---

### 5. Iris 分類（sklearn + pandas）

- **ねらい**: iris データを pandas で扱い、LogisticRegression で分類し正解率を求める。
- **使用ライブラリ**: pandas, sklearn.datasets, sklearn.linear_model, sklearn.model_selection
- **期待する解答の例**: 学習・予測後の accuracy を `ans` に代入する。
- **解説**: データを train_test_split で分割し、学習・予測ののち `accuracy_score` または `model.score()` で正解率を求める。

```python
import pandas as pd
from sklearn.datasets import load_iris
from sklearn.linear_model import LogisticRegression
from sklearn.model_selection import train_test_split
iris = load_iris()
X = iris.data
y = iris.target
X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=42)
model = LogisticRegression(max_iter=200).fit(X_train, y_train)
ans = model.score(X_test, y_test)
```

---

### 6. 相関係数（scipy）

- **ねらい**: scipy.stats の pearsonr で 2 配列のピアソン相関係数を求める。
- **使用ライブラリ**: scipy.stats
- **期待する解答の例**: 相関係数（スカラー）を `ans` に代入する。
- **解説**: `pearsonr(x, y)` は (r, pvalue) のタプルを返すので、先頭要素を `ans` にする。

```python
from scipy import stats
r, p = stats.pearsonr([1,2,3,4,5], [2,4,5,4,5])
ans = r
```

---

## 関連ドキュメント

- docs/01_specs/99_diff/0009_仕様と実装_細部差分_DD.md（DD-018～DD-022）
- docs/.drafts/import_questions.json
