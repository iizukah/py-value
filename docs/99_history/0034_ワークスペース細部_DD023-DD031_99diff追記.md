# 0034 ワークスペース細部（DD-023～DD-031）・99_diff 追記

## 日付

2025-02-07

## 実施内容概要

- **99_diff（docs/01_specs/99_diff/0009）**: 変更管理 ID を DD-001～DD-022 から **DD-001～DD-031** に拡張し、DD-023～DD-031 を表に追記した。
- **ワークスペース（python-analysis プラグイン）**:
  - **DD-023**: 遷移時に Pyodide をプリロードし、完了まで全画面オーバーレイ（stats-loader + 「準備中...」）を表示。`judge.ts` の `getPyodide` を export し、プラグイン mount 時の useEffect で呼び出し。
  - **DD-024**: 中央ペインの「コード」ラベルを削除。
  - **DD-025**: 入力コードの文字色をハイライト側で `var(--color-text)` に明示（CodeInputWithHighlight の pre/code）。
  - **DD-026**: 採点結果時の問題一覧を左ペインから削除し、中央ペインに表示。`displayResult` かつ `resultQuestionList.length > 0` のとき中央ペインで問題一覧を表示し、Retry でコード入力に戻す。
  - **DD-027**: 問題一覧の 10 問を個別 GET `/api/workbooks/:id/questions/:qId` で取得し、order/difficulty/tags/problem_statement を含めて CHALLENGE・難易度・タグ・問題文（line-clamp-2）で表示。
  - **DD-028**: 採点結果表示時、ツールバーに Retry の隣でお気に入りアイコン（Heart）を配置。GET favorites で現在問題のお気に入り状態を取得し、押下で POST/DELETE favorite でトグル。
  - **DD-029**: セル用スクロールバーを globals.css で `.cell-input` および `.cell-group-ws pre` に `scrollbar-color` / `::-webkit-scrollbar` でサイトトーンに合わせて定義。
  - **DD-030**: コピペ時の表示ずれ対策。CodeInputWithHighlight の onPaste で `\r\n` / `\r` を `\n` に正規化し、カーソル位置に挿入して onChange に渡す。
  - **DD-031**: 「下書き保存」の左にリセットボタン（Undo2 アイコン + 「リセット」）を追加。押下で cells を initial_code の 1 セルに戻し、judgeResult/resultTileVisible/resultQuestionList/lastRunVariables/cellRunOutput/plotImageBase64 をクリアし、表示をコード入力に戻す。

## 関連ドキュメント ID

- DD-023～DD-031（docs/01_specs/99_diff/0009_仕様と実装_細部差分_DD.md）
- プラン: UI・ワークスペース・履歴等の細部修正（セクション 8 ワークスペース、セクション 9 実装順序）

## 変更ファイル

- `src/core/plugins/python-analysis/judge.ts` — getPyodide を export
- `src/core/plugins/python-analysis/index.tsx` — 全画面ローディング、リセット、お気に入り、問題一覧中央ペイン、コードラベル削除
- `src/core/plugins/python-analysis/CodeInputWithHighlight.tsx` — ペースト正規化、文字色
- `src/app/globals.css` — セルスクロールバー
- `docs/01_specs/99_diff/0009_仕様と実装_細部差分_DD.md` — DD-023～DD-031 追記、タイトルを DD-001～DD-031 に更新
