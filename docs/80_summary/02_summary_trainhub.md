# TrainHub 本フェーズ総括・教訓

**作成日**: 2026-02-06  
**対象プロジェクト**: TrainHub  
**用途**: 本番デプロイ周りの修正・未解決事象の整理フェーズの総括と、今後の開発・引き継ぎのための教訓。

---

## 1. 目的

TrainHub の本フェーズ（本番デプロイ周りの修正・未解決事象の整理）の総括と、今後の開発・引き継ぎのための教訓をまとめる。01_summary.md は SnapMark 向けの引き継ぎ書であり、本ファイルは TrainHub プロジェクトに特化する。

---

## 2. 良かった点

- **報告書 00057** で 404・500・Storage・署名付き URL・RE_SYNC・sendWithPromise 等を一覧化し、実施内容と変更ファイルを追えるようにした。
- **ToDo.md** で未解決を「事象・実施した対応・想定要因・今後の検討」に分けて明文化し、報告書 8.2〜8.4 と対応させた。
- デバッグ時に仮説→計装→ログで RE_SYNC 404 の原因を特定し、最小 RE_SYNC 送信で対応した。
- **06_contexts** のスナップショット形式で、仕様・デプロイ・状態管理を圧縮して参照できるようにした（0005、0006）。

---

## 3. 悪かった点・課題

- **資料同期の UX**（「次へ」での読み込み中）が本番で未解決のまま。ローカルと本番で挙動が異なり、本番での計測が十分でなかった。
- **プロジェクトインポートの空の研修日**が、updateDay(0) 対応後も残る。バックエンドの day 0 自動作成とクライアントの処理順序・キャッシュの整合が未検証。
- **「ストレージから選択」が何も起きない**事象について、overflow クリップの考察はあるが未修正。再現環境での確認や Portal 化が未実施。
- 本番では計装ログが ingest に届かないため、本番事象の切り分けに別手段（コンソールやネットワークタブ）が必要だった。

---

## 4. 教訓・次回への提案

- 本番で再現する事象は、本番または staging で計測手段（ログ・メトリクス）を用意する。
- UI の「何も起きない」は、クリックが効いているか・state 更新があるか・表示がクリップされていないかを早めに確認する。
- 未解決は ToDo.md に残し、報告書（00057 等）からセクションで参照する形を維持する。
- インポートやバックエンド自動作成とクライアントの整合は、E2E または手順付きチェックリストで検証する。

---

## 5. 参照

- [docs/05_reports/00057_deployment_context_report.md](docs/05_reports/00057_deployment_context_report.md)（特にセクション 8）
- [docs/01_specs/diff/ToDo.md](docs/01_specs/diff/ToDo.md)
- [docs/06_contexts/0005_deployment_and_spec_snapshot.md](docs/06_contexts/0005_deployment_and_spec_snapshot.md)
- [docs/06_contexts/0006_recent_dev_context.md](docs/06_contexts/0006_recent_dev_context.md)
