# 0004 Stage 2 仕様整合確認結果

## 日付

2026-02-07

## 概要

Stage 2.1 に従い、01_specs の矛盾・不足・枠組みとプラグインの疎結合を確認した。**仕様書は修正せず**、差分・未反映項目のみ本 99_diff に記録する。

---

## 1. ID の重複・欠番

| 種別 | 確認結果 | 備考 |
|------|----------|------|
| REQ | REQ-01, REQ-02 のみ定義。重複・欠番なし。 |  |
| ARC | ARC-01（枠組み）, ARC-02（プラグイン）。重複・欠番なし。 |  |
| API | API-001～API-020 が API-01 で定義。重複・欠番なし。 | openapi.yaml が正本。 |
| DATA | DATA-01（共有）, DATA-02（プラグイン）。重複・欠番なし。 |  |
| 画面 SC | SC-000～SC-011。SC-007～SC-010 は管理系。重複・欠番なし。 | UX-01 で定義。 |
| コンポーネント CP | CP-000～CP-018（CP-001～014, 015～018）。重複・欠番なし。 | UX-02 で定義。 |
| 機能要件 FR | FR-F001～FR-F028（枠組み）, FR-P001～FR-P011（プラグイン）。範囲は README および REQ-01/REQ-02 と一致。 |  |
| UC | UC-F01～UC-F12, UC-P01～UC-P08。重複・欠番なし。 |  |

**結論**: ID の重複・欠番はなし。

---

## 2. タグ情報のデータ構造

- **DATA-01**: `QuestionBase` に `tags?: string[]` を定義済み（§2.1 および Firestore questions スキーマに `tags | string[]`）。
- **DATA-02**: QuestionBase を拡張。tags は共通基底のため DATA-02 で再定義不要。DATA-02 文書内で「DATA-01 QuestionBase（tags 等）」と参照あり。
- **UX-01 / UX-02**: タグフィルター（CP-016）、タグ表示（FR-F025, FR-F026）は DATA-01 の tags と整合。
- **API-01**: API-003 で `tags=タグ1,タグ2` でフィルター、Question に tags 含むと記載。

**結論**: タグのデータ構造と UX/API の整合に差分なし。

---

## 3. ワイヤーフレームの修正反映

**対象**: `04_ui_ux/wireframes/wireframes.html` が、99_diff 0001_wireframe_ui_changes.md および reference/mock.html（04_ui_ux 正の見た目）の内容をどこまで反映しているか。

| No. | 項目 | 状態 | 備考 |
|-----|------|------|------|
| 1 | **SC-000 ホーム・SC-011 お気に入り一覧のタブ** | 未反映 | ワイヤーフレームにタブが存在しない。SC-001～SC-010 とエラー例のみ。 |
| 2 | **SC-001 一覧下部の「履歴へ」リンク** | 未反映 | UX-01 では「一覧下部の『お気に入り』『履歴へ』は設けず、ヘッダーから遷移」としているが、wireframes.html の SC-001 パネルには `<p><a href="#履歴" class="btn btn-secondary">履歴へ</a></p>` が残っている。削除すべき。 |
| 3 | **ヘッダーナビに「お気に入り」** | 未反映 | CP-001 は「問題一覧・お気に入り・履歴・管理」とするが、ワイヤーフレームのヘッダは「問題一覧・履歴・管理」のみ。お気に入りを追加すべき。 |
| 4 | **ソートに「お気に入り数」** | 未反映 | CP-004 は「登録順・難易度・タイトル・お気に入り数」だが、ワイヤーフレームの SC-001 は「登録順・難易度・タイトル」のみ。お気に入り数ソートを追加すべき。 |
| 5 | **バッジ表記「合格」「不合格」** | 未反映 | 0001 では「合格」「不合格」に統一する旨。ワイヤーフレームでは「正解済」「未解答」等。履歴・採点結果と合わせ「合格」「不合格」等に揃える検討。 |
| 6 | **0001 のタイル・問題文冒頭・バッジ中央・中央ブロック・ヘッダ・管理の編集/削除** | 反映済み | question-tiles, tile-excerpt, center-block, header-block、管理の操作列はワイヤーフレームに存在。 |

---

## 4. 枠組みとプラグインの疎結合

| 確認項目 | 結果 | 備考 |
|----------|------|------|
| **ARC-01 と ARC-02 のインターフェース** | 枠組み側で定義 | ARC-01 がプラグインレジストリ・`runJudge(question, userAnswer)` の呼び出しを定義。ARC-02 は「Renderer（props 受け取り）」「judge.ts が runJudge を実装」と枠に依存。Renderer の props の詳細は ARC-01 に「問題データ、ユーザー解答、コールバック等」とあり、ARC-02 がそれに従う形。 |
| **API-01 と API-02** | 境界明確 | 枠組みは API-01。API-02 は 03_contracts/plugins にあり将来用。プラグインがサーバー API を持つ場合の拡張として言及されているのみ。 |
| **DATA-01 と DATA-02** | 境界明確 | QuestionBase は DATA-01。DATA-02 は type: python-analysis の拡張フィールドと JudgeResult。プラグインは DATA-02 を参照し、DATA-01 の共通基底を前提とする。 |
| **依存の向き** | プラグイン→枠組み | プラグインの都合で枠組みの契約が変わっている箇所はなし。JudgeResult は DATA-02 で定義されているが、API-01 の submit レスポンスと整合させる旨が DATA-02 にあり、枠組みの API 契約が先でプラグインが合わせる形。 |

**結論**: 枠組みとプラグインの疎結合は保たれている。依存が逆の箇所はなし。
