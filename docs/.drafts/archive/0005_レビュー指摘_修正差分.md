# 0005 レビュー指摘に基づく修正差分

## 日付

2026-02-07

## 概要

外部レビューで指摘された内容を**修正差分**としてまとめる。対象ドキュメントは REQ-01, DATA-01, API-01, UX-01, UX-02, ARC-01, TEST-01 および wireframes.html。実施時は本ファイルの項目に従い各仕様書を修正すること。

---

## 1. REQ-01 / DATA-01（お気に入りロジック）

### 1.1 指摘内容

- **FR-F027**（加算式：押すたびにカウント増）と **UC-F12**（トグル式：追加・解除）の矛盾を解消すること。
- **MVP 補足**: DATA-01 §2.5 に基づき、MVP では**モデル B**（1 ユーザー 1 ドキュメントでの count 保持）を採用する旨を明記すること。

### 1.2 修正差分

| 対象 | 修正内容 |
|------|----------|
| **REQ-01** | FR-F027 と UC-F12 の関係を整理する。例：FR-F027 を「データモデルは 1 ユーザー・1 問題あたり 1 ドキュメントで count を保持し、押下で count+1・解除で count-1」とし、UI 上は「お気に入り ON/OFF（トグル）」として追加・解除できる旨を記載。UC-F12 は「お気に入り一覧表示・挑戦・解除」とし、解除時は 1 回で 1 件分減算することを両者で一致させる。 |
| **DATA-01** | §2.5 お気に入り（Favorite）の冒頭に、**「MVP ではモデル B を採用する」**旨を明記する。モデル B の定義（1 ユーザー・1 問題あたり 1 ドキュメントで count を保持、追加で +1・解除で -1、0 で削除）を既存のまま残し、「本モデルを MVP の正式な仕様とする」等の一文を追加する。 |

---

## 2. API-01（REST 契約）

### 2.1 指摘内容

- Azure のベストプラクティスに従い、`/import` や `/export` など**動詞を含む URI** について、**リソース指向（名詞）**への再考案を提示すること。
- **MVP 補足**: API-010～017（管理系 API）は、MVP では**簡易キー認証による最低限の保護に留める**旨を追記すること。

### 2.2 修正差分

| 対象 | 修正内容 |
|------|----------|
| **API-01**（および openapi.yaml） | **URI の再考案（リソース指向）**: 動詞ベースのパスを名詞ベースに変更する案を提示する。例：`POST /api/admin/.../import` → `POST /api/admin/workbooks/{workbookId}/data-bulk`（一括投入）や `POST /api/admin/workbooks/{workbookId}/questions/bulk`、`GET /api/admin/.../export` → `GET /api/admin/workbooks/{workbookId}/data-bulk` または `GET /api/admin/workbooks/{workbookId}/questions/exported` 等。具体的なパス案を API-01 の「修正案」または「99_diff 対応」節に記載し、openapi.yaml 更新時に反映する。 |
| **API-01** | **管理系 API の MVP 補足**: §2.2 または API-010～017 の説明に、「MVP では簡易キー（クエリ key）認証による最低限の保護に留め、ロールベース認証等は将来 Phase とする」旨を追記する。 |

---

## 3. UX-01 / UX-02（画面・コンポーネント）および wireframes.html

### 3.1 指摘内容

- **0001** および **0004** の指摘に基づき、ワイヤーフレーム（wireframes.html）と仕様書の不整合を修正すること。  
  具体的には：SC-001 の削除漏れリンク、ヘッダのお気に入りボタン欠如等。
- 表記を**「合格/不合格」**および**「Passed/Fail」**に統一すること。
- **MVP 補足**: SC-003（採点結果）の CSS 不具合（タイル幅 50% 等）は、**0002** の内容に基づき「今後の改善事項」として記載し、**MVP では現状の表示を許容**すること。

### 3.2 修正差分

| 対象 | 修正内容 |
|------|----------|
| **wireframes.html** | ① **SC-001 問題一覧**：一覧下部の「履歴へ」リンク（`<p><a href="#履歴" …>履歴へ</a></p>`）を**削除**する。② **ヘッダ（CP-001）**：ナビに**「お気に入り」**を追加する（問題一覧・お気に入り・履歴・管理の順）。③ **ソート**：SC-001 に「お気に入り数」ソートを追加する。④ **バッジ・結果表記**：「正解済」「未解答」等を**「合格」「不合格」**に統一する。採点結果エリアでは **Passed/Fail** の表記を用いる。 |
| **UX-01** | SC-005, SC-006, SC-003 および他画面で、正誤の表記を**「合格」「不合格」**で統一する。採点結果（SC-003）ではバッジ表記 **Passed/Fail** を仕様として明記する。SC-003 の説明に、**「今後の改善事項」**として「タイル幅を画面の約 50% にする」「Retry ボタンをタイルの右下端に配置する」等を 0002 に基づき記載し、**MVP では現状の表示を許容する**旨を追記する。 |
| **UX-02** | CP-005, CP-006, CP-009 等で、結果表記を**「合格」「不合格」**および **Passed/Fail** に統一する。CP-001 のヘッダナビに「お気に入り」が含まれることは既に記載済みであれば、wireframes との整合のみ確認する。 |

---

## 4. ARC-01 / TEST-01（アーキテクチャ・テスト）および NFR-P001

### 4.1 指摘内容

- **WASM（Pyodide）ロード失敗時**のフォールバックおよびエラーハンドリングを**具体化**すること（**NFR-P001**）。
- **MVP 補足**: テスト（TEST-01）においては、管理機能や履歴の**複雑なバリデーションテストは MVP 外**とし、**導線確認に留める**旨を明記すること。

### 4.2 修正差分

| 対象 | 修正内容 |
|------|----------|
| **REQ-02**（NFR-P001） | Pyodide ロード失敗時の**フォールバック**を具体化する。例：ロード失敗時は「実行環境の読み込みに失敗しました。ページを再読み込みしてください。」等のメッセージを表示し、**実行・採点ボタンを無効化**する。ワークスペースは問題文の閲覧のみ可能とするか、あるいはエラー状態のみ表示とする旨を NFR-P001 に追記する。 |
| **ARC-01** または **ARC-02** | プラグイン呼び出し前に Pyodide のロード状態を確認し、失敗時は枠組みがエラー表示に切り替える方針を 1 節で記載する。エラーハンドリングの責任分界（枠組みがロード失敗を検知し、UI は UX-02/04_ui_ux の文言に従う）を明記する。 |
| **TEST-01** | **MVP 範囲のテスト方針**を追記する。管理機能（API-010～017 や SC-007～SC-010）および履歴（API-005, API-006）については、MVP では**複雑なバリデーションや権限テストは対象外**とし、**導線確認（画面遷移・API が key 付きで呼べる等）に留める**旨を §6 実施方針または新規 subsection に明記する。 |

---

## 5. 関連 99_diff

| ファイル | 関連する指摘 |
|----------|--------------|
| 0001_wireframe_ui_changes.md | ワイヤーフレームと仕様書の差分（合格/不合格、ヘッダ、タイル等）。本 0005 の §3 で反映する。 |
| 0002_採点結果画面_未対応TODO.md | SC-003 のタイル幅・Retry 位置。本 0005 の §3 で「今後の改善事項」「MVP では現状許容」として扱う。 |
| 0004_stage2_specs_consistency_check.md | ワイヤーフレーム未反映項目（SC-001 下部リンク削除、ヘッダお気に入り、ソート、バッジ表記）。本 0005 の §3 で修正対象として整理。 |

---

## 6. 実施時の注意

- 上記は**修正差分**であり、実際の仕様書・wireframes.html の変更は別途実施する。
- 修正後、必要に応じて 99_history に「0005 レビュー指摘対応」として記録する。
- openapi.yaml の URI 変更は API-01 の修正案が確定してから行う。
