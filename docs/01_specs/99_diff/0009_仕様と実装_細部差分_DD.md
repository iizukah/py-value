# 0009 仕様と実装 細部差分（変更管理 ID: DD-001～DD-031）

## 日付

2025-02-07

## 目的

- 現時点で残っている仕様書との差分・未反映・曖昧な点を一覧化する。
- 変更管理 ID: **DD-001 ～ DD-031**（Detail Diff）。本プランで対応する細部修正のトレースに利用する。
- 参照: mock.html、API-01、DATA-01、0008_Webデザイン変更一覧_CD.md。

---

## 変更一覧

| ID | 項目（概要） | 仕様上の扱い | 現行実装 | 方針 |
|----|--------------|--------------|----------|------|
| DD-001 | パンくずのレイアウト中央寄せ | mock .main-content で幅制限 | 左寄せ | .breadcrumb に max-width + margin: 0 auto で main と揃える |
| DD-002 | パンくず項目へのアイコン付与 | mock では区切りのみ | ホーム・ワークブックにアイコンあり、お気に入り/履歴/問題はテキストのみ | お気に入り→Heart、履歴→History、問題→FileCode 等を付与 |
| DD-003 | 履歴一覧に問題タイトルを表示 | API-005 は questionId のみ、DATA-01 History に title なし | 「問題 {questionId}」表示 | クライアントで問題一覧 GET して questionId→title マップで表示（API 変更なし） |
| DD-004 | 履歴一覧 td 内の位置 | — | 左に詰まりすぎ | 左揃え維持しつつテーブル中央寄せ・td の padding で調整 |
| DD-005 | パンくずのラベルを ID からタイトルに | — | 問題ページ・履歴詳細で questionId/historyId 表示 | Breadcrumb 内で path に応じ API 取得し最終セグメントをタイトルに差し替え |
| DD-006 | ワークスペース Retry 挙動 | 仕様に明示なし | 採点結果ブロック内に Retry、ツールバーは「解答送信」固定 | 結果ブロックから Retry 削除。結果表示後はツールバーを「Retry」にし、押下で状態リセットのみ（ユーザーが再入力し解答送信） |
| DD-007 | 下書き保存のフィードバック | API-008 は契約のみ | 保存成功時フィードバックなし | 保存成功時に brief 表示（例: 2～3 秒「保存しました」または aria-live） |
| DD-008 | 下書きの導線（問題一覧に Draft） | 仕様に明示なし | 問題一覧に Draft 導線なし | タイルのお気に入りと Try の間に「アイコン＋Draft」。押下でワークスペースへ。下書きなしはグレーアウト・押下不可 |
| DD-009 | 下書き一覧 API | API-01 に未定義 | GET draft は 1 問題 1 件のみ | 新規 API-021: GET /api/workbooks/{workbookId}/drafts?X-Client-Id で下書きがある questionId 一覧を返す。99_diff および 03_contracts に記載 |
| DD-010 | ワークスペース複数セル・実行/追加/削除 | mock に cell-group-ws、cell-actions（Run/追加/削除） | 単一 textarea | セル配列で管理、各セルに Run・追加・削除。セル単位 Run で実行結果を Variable Watcher とセル下に表示。userAnswer は { cells: [...] } |
| DD-011 | 管理画面保存成功メッセージ | — | 保存後「保存しました。」表示してからリダイレクト | 成功時はメッセージを出さず即 window.location.href = backUrl |
| DD-012 | ワークスペース ローディング表示 | 仕様にデザイン詳細なし | 初回・セル Run 時にオーバーレイなし | 初回（Pyodide＋パッケージ）およびセル Run 実行中に stats-loader + メッセージを中央ペインに表示（pyvalue5 相当） |
| DD-013 | パンくず「問題」404・表示形式 | 仕様に明示なし | 「問題」href が /wb/questions で 404 | buildBreadcrumbs で「問題」単体を出さず、問題ページ最終項目を「問題: {title}」で表示 |
| DD-014 | ページタイトル typography | mock .typography-title あり | 各 h1 は font-bold のみ | 問題一覧・お気に入り・履歴・履歴詳細の h1 に typography-title を適用 |
| DD-015 | セル下を stdout/stderr 表示 | DATA-02 §4.2 標準出力・標準エラー保持 | セル下に変数一覧を表示 | runCodeAndGetVariables で stdout/stderr を取得し、セル直下に Jupyter 風で表示 |
| DD-016 | Pyodide パッケージ導入 | INFRA-01, DATA-02 | 未導入 | loadPackage で numpy, matplotlib, pandas, scipy, scikit-learn, statsmodels を導入 |
| DD-017 | Matplotlib DOM 投影（FR-P003） | REQ-02 FR-P003 | 未実装 | plt.show() 実行時に get_fignums から savefig base64 を取得し、右ペイン Result Plot に表示 |
| DD-018 | 問題一覧「ステータスでフィルター」 | 仕様に明示なし | フィルターなし | 全て／未挑戦／未合格／合格。未合格は未挑戦または不合格。URL status=all\|not_attempted\|not_passed\|passed、クライアントで statusByQuestion をフィルタ |
| DD-019 | 問題一覧「難易度でフィルター」 | 仕様に明示なし | フィルターなし | 全て／初級／中級／上級。URL difficulty=、questions を difficulty でクライアントフィルタ |
| DD-020 | 問題一覧・ソート／フィルター折りたたみ | 仕様に明示なし | 常時表示 | ソート・ステータス・難易度・タグを折りたたみ可能にし、デフォルトは折りたたみ（見出しクリックで展開） |
| DD-021 | ワークスペース採点結果時の問題一覧 | 仕様に明示なし | なし | 採点結果表示中に問題一覧をランダム最大10問表示し別問題へリンク。Retry 押下で非表示 |
| DD-022 | ワークスペース Python コードハイライト | 仕様に明示なし | プレーンテキスト | コード入力に Python シンタックスハイライト（軽量オーバーレイ・差し替え可能設計）を適用 |
| DD-023 | ワークスペース遷移時の全画面ローディング | 仕様に明示なし | なし | Pyodide を mount 時に getPyodide() でプリロードし、完了まで全画面オーバーレイを表示 |
| DD-024 | 中央ペイン「コード」ラベル削除 | 仕様に明示なし | 「コード」ラベルあり | 中央ペインの「コード」という label を削除 |
| DD-025 | 入力コードの文字色 | 仕様に明示なし | 背景と同化する場合あり | ハイライト側 pre/code のデフォルト色を var(--color-text) で明示 |
| DD-026 | 採点結果時の問題一覧を中央ペインに表示 | DD-021 で左ペインに問題一覧 | 左ペインの採点結果内に問題一覧 | displayResult 時は中央ペインでコード入力の代わりに問題一覧を表示。左ペインから問題一覧ブロックを削除 |
| DD-027 | 問題一覧の内容（CHALLENGE・難易度・タグ・問題文） | DD-021 でタイトルのみ | 一覧 API で id+title のみ | 10 問を個別 GET で order/difficulty/tags/problem_statement を取得し、問題一覧画面と同様に表示 |
| DD-028 | Retry の隣にお気に入り | 仕様に明示なし | なし | 採点結果表示時、ツールバーに Retry の隣でお気に入りアイコン。POST/DELETE favorite、GET favorites で状態表示 |
| DD-029 | セルスクロールバー | 仕様に明示なし | デフォルト | .cell-input および .cell-group-ws pre で scrollbar-color / ::-webkit-scrollbar をサイトトーンに合わせる |
| DD-030 | コピペ時の表示ずれ | 仕様に明示なし | \r\n でずれる場合あり | onPaste で \r\n→\n に正規化し、カーソル位置に挿入。value を単一ソースに |
| DD-031 | リセットボタン | 仕様に明示なし | なし | 「下書き保存」の左にリセットアイコン。押下で cells を initial_code の1セルに、採点・変数・プロットをクリアしコード入力に戻す |

---

## DRAFT 関連 ID（既存続き）

- **要件**: FR-F030 以降（REQ-01 に追記する場合の番号）。下書き一覧取得・問題一覧からの下書き導線。
- **API**: API-021 GET /api/workbooks/{workbookId}/drafts
- **テスト**: TEST-01 に DRAFT 用セクションを追記。単体・結合・E2E でテスト実装する。

---

## 関連

- docs/01_specs/04_ui_ux/reference/mock.html
- docs/01_specs/03_contracts/API-01_rest_contract.md
- docs/01_specs/03_contracts/DATA-01_shared_types_and_schemas.md
- 0008_Webデザイン変更一覧_CD.md
